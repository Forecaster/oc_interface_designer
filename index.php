<?
//Created 05/03/2016

$ascii_characters = array(
	array("dex" => "128", "hex" => "80", "Binary" => "10000000", "char" => "Ç"),
  array("dex" => "129", "hex" => "81", "Binary" => "10000001", "char" => "ü"),
  array("dex" => "130", "hex" => "82", "Binary" => "10000010", "char" => "é"),
  array("dex" => "131", "hex" => "83", "Binary" => "10000011", "char" => "â"),
  array("dex" => "132", "hex" => "84", "Binary" => "10000100", "char" => "ä"),
  array("dex" => "133", "hex" => "85", "Binary" => "10000101", "char" => "à"),
  array("dex" => "134", "hex" => "86", "Binary" => "10000110", "char" => "å"),
  array("dex" => "135", "hex" => "87", "Binary" => "10000111", "char" => "ç"),
  array("dex" => "136", "hex" => "88", "Binary" => "10001000", "char" => "ê"),
  array("dex" => "137", "hex" => "89", "Binary" => "10001001", "char" => "ë"),
  array("dex" => "138", "hex" => "8A", "Binary" => "10001010", "char" => "è"),
  array("dex" => "139", "hex" => "8B", "Binary" => "10001011", "char" => "ï"),
  array("dex" => "140", "hex" => "8C", "Binary" => "10001100", "char" => "î"),
  array("dex" => "141", "hex" => "8D", "Binary" => "10001101", "char" => "ì"),
  array("dex" => "142", "hex" => "8E", "Binary" => "10001110", "char" => "Ä"),
  array("dex" => "143", "hex" => "8F", "Binary" => "10001111", "char" => "Å"),
  array("dex" => "144", "hex" => "90", "Binary" => "10010000", "char" => "É"),
  array("dex" => "145", "hex" => "91", "Binary" => "10010001", "char" => "æ"),
  array("dex" => "146", "hex" => "92", "Binary" => "10010010", "char" => "Æ"),
  array("dex" => "147", "hex" => "93", "Binary" => "10010011", "char" => "ô"),
  array("dex" => "148", "hex" => "94", "Binary" => "10010100", "char" => "ö"),
  array("dex" => "149", "hex" => "95", "Binary" => "10010101", "char" => "ò"),
  array("dex" => "150", "hex" => "96", "Binary" => "10010110", "char" => "û"),
  array("dex" => "151", "hex" => "97", "Binary" => "10010111", "char" => "ù"),
  array("dex" => "152", "hex" => "98", "Binary" => "10011000", "char" => "ÿ"),
  array("dex" => "153", "hex" => "99", "Binary" => "10011001", "char" => "Ö"),
  array("dex" => "154", "hex" => "9A", "Binary" => "10011010", "char" => "Ü"),
  array("dex" => "155", "hex" => "9B", "Binary" => "10011011", "char" => "¢"),
  array("dex" => "156", "hex" => "9C", "Binary" => "10011100", "char" => "£"),
  array("dex" => "157", "hex" => "9D", "Binary" => "10011101", "char" => "¥"),
  array("dex" => "158", "hex" => "9E", "Binary" => "10011110", "char" => "₧"),
  array("dex" => "159", "hex" => "9F", "Binary" => "10011111", "char" => "ƒ"),
  array("dex" => "160", "hex" => "A0", "Binary" => "10100000", "char" => "á"),
  array("dex" => "161", "hex" => "A1", "Binary" => "10100001", "char" => "í"),
  array("dex" => "162", "hex" => "A2", "Binary" => "10100010", "char" => "ó"),
  array("dex" => "163", "hex" => "A3", "Binary" => "10100011", "char" => "ú"),
  array("dex" => "164", "hex" => "A4", "Binary" => "10100100", "char" => "ñ"),
  array("dex" => "165", "hex" => "A5", "Binary" => "10100101", "char" => "Ñ"),
  array("dex" => "166", "hex" => "A6", "Binary" => "10100110", "char" => "ª"),
  array("dex" => "167", "hex" => "A7", "Binary" => "10100111", "char" => "º"),
  array("dex" => "168", "hex" => "A8", "Binary" => "10101000", "char" => "¿"),
  array("dex" => "169", "hex" => "A9", "Binary" => "10101001", "char" => "⌐"),
  array("dex" => "170", "hex" => "AA", "Binary" => "10101010", "char" => "¬"),
  array("dex" => "171", "hex" => "AB", "Binary" => "10101011", "char" => "½"),
  array("dex" => "172", "hex" => "AC", "Binary" => "10101100", "char" => "¼"),
  array("dex" => "173", "hex" => "AD", "Binary" => "10101101", "char" => "¡"),
  array("dex" => "174", "hex" => "AE", "Binary" => "10101110", "char" => "«"),
  array("dex" => "175", "hex" => "AF", "Binary" => "10101111", "char" => "»"),
  array("dex" => "176", "hex" => "B0", "Binary" => "10110000", "char" => "░"),
  array("dex" => "177", "hex" => "B1", "Binary" => "10110001", "char" => "▒"),
  array("dex" => "178", "hex" => "B2", "Binary" => "10110010", "char" => "▓"),
  array("dex" => "179", "hex" => "B3", "Binary" => "10110011", "char" => "│"),
  array("dex" => "180", "hex" => "B4", "Binary" => "10110100", "char" => "┤"),
  array("dex" => "181", "hex" => "B5", "Binary" => "10110101", "char" => "╡"),
  array("dex" => "182", "hex" => "B6", "Binary" => "10110110", "char" => "╢"),
  array("dex" => "183", "hex" => "B7", "Binary" => "10110111", "char" => "╖"),
  array("dex" => "184", "hex" => "B8", "Binary" => "10111000", "char" => "╕"),
  array("dex" => "185", "hex" => "B9", "Binary" => "10111001", "char" => "╣"),
  array("dex" => "186", "hex" => "BA", "Binary" => "10111010", "char" => "║"),
  array("dex" => "187", "hex" => "BB", "Binary" => "10111011", "char" => "╗"),
  array("dex" => "188", "hex" => "BC", "Binary" => "10111100", "char" => "╝"),
  array("dex" => "189", "hex" => "BD", "Binary" => "10111101", "char" => "╜"),
  array("dex" => "190", "hex" => "BE", "Binary" => "10111110", "char" => "╛"),
  array("dex" => "191", "hex" => "BF", "Binary" => "10111111", "char" => "┐"),
  array("dex" => "192", "hex" => "C0", "Binary" => "11000000", "char" => "└"),
  array("dex" => "193", "hex" => "C1", "Binary" => "11000001", "char" => "┴"),
  array("dex" => "194", "hex" => "C2", "Binary" => "11000010", "char" => "┬"),
  array("dex" => "195", "hex" => "C3", "Binary" => "11000011", "char" => "├"),
  array("dex" => "196", "hex" => "C4", "Binary" => "11000100", "char" => "─"),
  array("dex" => "197", "hex" => "C5", "Binary" => "11000101", "char" => "┼"),
  array("dex" => "198", "hex" => "C6", "Binary" => "11000110", "char" => "╞"),
  array("dex" => "199", "hex" => "C7", "Binary" => "11000111", "char" => "╟"),
  array("dex" => "200", "hex" => "C8", "Binary" => "11001000", "char" => "╚"),
  array("dex" => "201", "hex" => "C9", "Binary" => "11001001", "char" => "╔"),
  array("dex" => "202", "hex" => "CA", "Binary" => "11001010", "char" => "╩"),
  array("dex" => "203", "hex" => "CB", "Binary" => "11001011", "char" => "╦"),
  array("dex" => "204", "hex" => "CC", "Binary" => "11001100", "char" => "╠"),
  array("dex" => "205", "hex" => "CD", "Binary" => "11001101", "char" => "═"),
  array("dex" => "206", "hex" => "CE", "Binary" => "11001110", "char" => "╬"),
  array("dex" => "207", "hex" => "CF", "Binary" => "11001111", "char" => "╧"),
  array("dex" => "208", "hex" => "D0", "Binary" => "11010000", "char" => "╨"),
  array("dex" => "209", "hex" => "D1", "Binary" => "11010001", "char" => "╤"),
  array("dex" => "210", "hex" => "D2", "Binary" => "11010010", "char" => "╥"),
  array("dex" => "211", "hex" => "D3", "Binary" => "11010011", "char" => "╙"),
  array("dex" => "212", "hex" => "D4", "Binary" => "11010100", "char" => "╘"),
  array("dex" => "213", "hex" => "D5", "Binary" => "11010101", "char" => "╒"),
  array("dex" => "214", "hex" => "D6", "Binary" => "11010110", "char" => "╓"),
  array("dex" => "215", "hex" => "D7", "Binary" => "11010111", "char" => "╫"),
  array("dex" => "216", "hex" => "D8", "Binary" => "11011000", "char" => "╪"),
  array("dex" => "217", "hex" => "D9", "Binary" => "11011001", "char" => "┘"),
  array("dex" => "218", "hex" => "DA", "Binary" => "11011010", "char" => "┌"),
  array("dex" => "219", "hex" => "DB", "Binary" => "11011011", "char" => "█"),
  array("dex" => "220", "hex" => "DC", "Binary" => "11011100", "char" => "▄"),
  array("dex" => "221", "hex" => "DD", "Binary" => "11011101", "char" => "▌"),
  array("dex" => "222", "hex" => "DE", "Binary" => "11011110", "char" => "▐"),
  array("dex" => "223", "hex" => "DF", "Binary" => "11011111", "char" => "▀"),
  array("dex" => "224", "hex" => "E0", "Binary" => "11100000", "char" => "α"),
  array("dex" => "225", "hex" => "E1", "Binary" => "11100001", "char" => "ß"),
  array("dex" => "226", "hex" => "E2", "Binary" => "11100010", "char" => "Γ"),
  array("dex" => "227", "hex" => "E3", "Binary" => "11100011", "char" => "π"),
  array("dex" => "228", "hex" => "E4", "Binary" => "11100100", "char" => "Σ"),
  array("dex" => "229", "hex" => "E5", "Binary" => "11100101", "char" => "σ"),
  array("dex" => "230", "hex" => "E6", "Binary" => "11100110", "char" => "µ"),
  array("dex" => "231", "hex" => "E7", "Binary" => "11100111", "char" => "τ"),
  array("dex" => "232", "hex" => "E8", "Binary" => "11101000", "char" => "Φ"),
  array("dex" => "233", "hex" => "E9", "Binary" => "11101001", "char" => "Θ"),
  array("dex" => "234", "hex" => "EA", "Binary" => "11101010", "char" => "Ω"),
  array("dex" => "235", "hex" => "EB", "Binary" => "11101011", "char" => "δ"),
  array("dex" => "236", "hex" => "EC", "Binary" => "11101100", "char" => "∞"),
  array("dex" => "237", "hex" => "ED", "Binary" => "11101101", "char" => "φ"),
  array("dex" => "238", "hex" => "EE", "Binary" => "11101110", "char" => "ε"),
  array("dex" => "239", "hex" => "EF", "Binary" => "11101111", "char" => "∩"),
  array("dex" => "240", "hex" => "F0", "Binary" => "11110000", "char" => "≡"),
  array("dex" => "241", "hex" => "F1", "Binary" => "11110001", "char" => "±"),
  array("dex" => "242", "hex" => "F2", "Binary" => "11110010", "char" => "≥"),
  array("dex" => "243", "hex" => "F3", "Binary" => "11110011", "char" => "≤"),
  array("dex" => "244", "hex" => "F4", "Binary" => "11110100", "char" => "⌠"),
  array("dex" => "245", "hex" => "F5", "Binary" => "11110101", "char" => "⌡"),
  array("dex" => "246", "hex" => "F6", "Binary" => "11110110", "char" => "÷"),
  array("dex" => "247", "hex" => "F7", "Binary" => "11110111", "char" => "≈"),
  array("dex" => "248", "hex" => "F8", "Binary" => "11111000", "char" => "°"),
  array("dex" => "249", "hex" => "F9", "Binary" => "11111001", "char" => "∙"),
  array("dex" => "250", "hex" => "FA", "Binary" => "11111010", "char" => "·"),
  array("dex" => "251", "hex" => "FB", "Binary" => "11111011", "char" => "√"),
  array("dex" => "252", "hex" => "FC", "Binary" => "11111100", "char" => "ⁿ"),
  array("dex" => "253", "hex" => "FD", "Binary" => "11111101", "char" => "²"),
  array("dex" => "254", "hex" => "FE", "Binary" => "11111110", "char" => "■"),
  array("dex" => "255", "hex" => "FF", "Binary" => "11111111", "char" => " ")
);
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OpenComputers Interface Designer</title>
  <link rel="stylesheet" href="main.css"/>
  <script src="oc.js" type="text/javascript"></script>
  <script src="gui.js" type="text/javascript"></script>
  <script src="main.js" type="text/javascript"></script>
  <script src="util.js" type="text/javascript"></script>
  <script src="code.js" type="text/javascript"></script>
  <script src="screen.js" type="text/javascript"></script>
	<script src="fengari-web.js" type="text/javascript"></script>
  <script src="color_picker.js" type="text/javascript"></script>
</head>
<body>
<h1>OpenComputers Interface Designer <span class="state"></span></h1>
<div class="main-container">
	<div id="monitor" class="monitor">
		<div class="monitor_part monitor_top"></div>
		<div class="monitor_part monitor_bottom"></div>
		<div class="monitor_part monitor_left"></div>
		<div class="monitor_part monitor_right"></div>
		<div class="monitor_part monitor_top_left"></div>
		<div class="monitor_part monitor_top_right"></div>
		<div class="monitor_part monitor_bottom_left"></div>
		<div class="monitor_part monitor_bottom_right"></div>
		<div id="screen_container" class="screen_container">
			<div id="screen" class="screen">
				<div id="pixel_container"></div>
				<div id="shape_container" class="shape_container"></div>
				<div id="selector_shape_container" class="shape_container"></div>
				<div id="pixel_select_container" class="pixel_select_container"></div>
			</div>
		</div>
		<canvas id="grid_container" class="grid"></canvas>
	</div>
	<div>Mode: <span id="current_mode" style="color: red;">EDIT</span></div>
	<div class="container">
		<div class="col-6">
			<h4><label for="shapes_opacity">Shapes opacity</label></h4>
			<div><input id="shapes_opacity" type="number" min="0" max="100" value="100" onchange="setShapesOpacity(this.value)" />%</div>
		</div>
		<div class="col-6">
			<h4><label for="grid_opacity">Grid opacity</label></h4>
			<div><input id="grid_opacity" type="number" min="0" max="100" value="20" onchange="setGridOpacity(this.value)" />%</div>
		</div>
	</div>
  <div class="container msg_box" id="messages"></div>
	<p style="width: 400px;">Draw shapes on the screen above to add them to the reference list below. Click a shape to toggle visibility. Right-click for additional options.</p>
	<div id="shape_list_container">No shapes drawn yet.	</div>
</div>
<div class="main-container" style="width: 600px;">
	<h3><label for="code_area">Main area:</label></h3>
	<p>This code is run once when you hit run.</p>
	<textarea name="code_area" id="code_area" style="width: 100%; height: 200px; resize: vertical; margin-bottom: 20px;" placeholder="GPU code area"></textarea>
	<h3><label for="code_area_touch">OnTouch area</label></h3>
	<p>After running the main block, clicking on the screen will call the code in this field. You can use the variables `x` and `y` here which are set to the column and row of the clicked pixel respectively.</p>
	<p>Think of this as what you would put inside a touch event listener.</p>
	<textarea name="code_area_touch" id="code_area_touch" style="width: 100%; height: 200px; resize: vertical;" placeholder="OnTouch code area"></textarea>
	<button id="code_start" onclick="run()">Run</button>
	<button id="code_stop" onclick="stop()" disabled="disabled">Stop</button>
	<h3>Print output:</h3>
	<div id="code_output" class="console" style="margin-top: 20px;"></div>
</div>
<div class="main-container" style="width: 600px;">
	<p>Available components/libraries:</p>
	<ul>
		<li><a href="https://ocdoc.cil.li/component:gpu?s[]=gpu">GPU</a> - Call as if having assigned the gpu component to the variable `gpu`. For example: <code>gpu.fill(x, y, w, h, char)</code></li>
		<li><a href="fgui">FGUI</a> - Call as if having assigned the library to the variable `fgui`. For example: <code>fgui.writeTextCentered(text, line, color, background_color)</code></li>
	</ul>
  <div class="container">Controls:</div>
	<div class="container">
		<div>Width, Height</div>
		<input type="number" id="block_width" placeholder="Width" min="1" max="8" />
		<input type="number" id="block_height" placeholder="Height" min="1" max="6" />
		<button onclick="setScreenSizeControl()">Set Screen Size (Blocks)</button>
	</div>
  <div class="container" style="display: none;">
		<div><span>Width</span><span style="margin-left: 140px;">Height</span></div>
    <input type="number" id="res_width" placeholder="Width" />
    <input type="number" id="res_height" placeholder="Height" />
    <button onclick="SetResolutionControl()">Set Resolution</button>
  </div>
  <div class="container" style="display: none;">
    <div class="container">Resolution Presets (Doesn't change screen size):</div>
    <div class="container" id="resolution_presets"></div>
  </div>
	<div class="container">
		<p>Common resolutions:</p>
		<ul>
			<li>T1 Screen: 50 x 16</li>
			<li>T2 Screen: 80 x 25</li>
			<li>T3 Screen: 160 x 50</li>
			<li>Tablet: 80 x 25</li>
		</ul>
	</div>
  <div class="container">
    <table>
      <TR><TD><label for="color_value">Web Hex:</label></TD><TD><input type="text" placeholder="Web Hex Value" id="color_value"/></TD></TR>
      <TR><TD><label for="color_value_computronics">Lua Hex:</label></TD><TD><input type="text" placeholder="Lua Hex Value" id="color_value_computronics"/></TD></TR>
    </table>
  </div>
	<div class="container">
		<div>Insert method call using currently selected color:</div>
		<div onclick="code_area.value = generateAndInsertMethodCall(code_area.value, 'gpu.setBackground', { color: document.getElementById('color_value_computronics').value }); saveInputField(code_area);" style="cursor: pointer;">setBackground</div>
		<div onclick="code_area.value = generateAndInsertMethodCall(code_area.value, 'gpu.setForeground', { color: document.getElementById('color_value_computronics').value }); saveInputField(code_area);" style="cursor: pointer;">setForeground</div>
	</div>
  <div id="current_color">Current Color</div>
  <div class="container" style="margin-top: 10px;" id="color_picker">
  </div>
	<div class="container">
		<p>CURRENT STATE: <span class="state"></span></p>
		<p>Alpha means many features are missing or broken, as I'm still in the middle of re-writing this application.</p>
		<p>Please report any issues or request features on the <a href="https://github.com/Forecaster/oc_interface_designer">GitHub repository</a>.</p>
		<p>You may also visit my <a href="http://towerofawesome.org/forum/forumdisplay.php?fid=58">forum</a>, join my <a href="https://discord.gg/mx849JN">Discord server</a>, join #oc on <a href="http://esper.net">esper.net</a> via IRC or <a href="https://discord.gg/0hVukoQ2KYifZFCA">OpenComputers discord server</a> and poke Forecaster to get help, report bugs or provide suggestions!</p>
		<p>This application is for assisting with creating graphical interfaces for OpenComputers programs, something that I've always found slightly intimidating because it requires dealing with coordinates and stuff. Which means lots of numbers to keep track of.</p>
		<p>Notable features:</p>
		<ul>
			<li>Test gpu code quickly and easily</li>
			<li>Test buttons</li>
			<li>Pick colors for use in-game or for testing</li>
			<li>Draw shapes on the screen to quickly acquire positions and sizes</li>
			<li>More stuff probably</li>
		</ul>
	</div>
</div>
</body>

<script>
	let monitors = [];
	const code_area = document.getElementById("code_area");
	const code_area_touch = document.getElementById("code_area_touch");
	const code_output = document.getElementById("code_output");
	const code_start = document.getElementById("code_start");
	const code_stop = document.getElementById("code_stop");
	const current_mode = document.getElementById("current_mode");
	const shape_list_container = document.getElementById("shape_list_container");

	const pixelWidth = 8;
	const pixelHeight = 16;

	let screenWidth = 4;
	let screenHeight = 2;

	const blockWidth = 418/screenWidth;
	const blockHeight = 274/screenHeight;

	let width = 160;
	let height = 50;

	const maxScreenWidth = 8;
	const maxScreenHeight = 6;

	let background = "#000000";
	let foreground = "#F0F0F0";

	const colors = {
		rows: ["00", "33", "66", "99", "CC", "FF"],
		blocks: ["00", "24", "49", "6D", "92", "B6", "DB", "FF"],
		columns: ["00", "40", "80", "C0", "FF"],
		grays: ["0F", "1E", "2D", "4B", "5A", "69", "78", "87", "96", "A5", "B4", "C3", "D2", "E1", "F0"]
	};

	const max_resolution_area = 8000;

	// setScreenSize(document.getElementById("monitor"), screenWidth, screenHeight);
  // setResolution(document.getElementById("monitor"), 50, 16);

	createMonitor(document.getElementById("monitor"), 50, 16);

  generate_color_picker();
  update_current_colors();

  document.onclick = function(event) {
  	destroyContextMenu();
	}

	let areas = document.getElementsByTagName("textarea");
	for (let i in areas) {
		let elem = areas[i];
		elem.onkeydown = function(event) {
			if (event.key === "Tab") {
				event.preventDefault();
				let start = elem.selectionStart;
				let end = elem.selectionEnd;
				elem.value = elem.value.substr(0, start) + "\t" + elem.value.substr(end);
				elem.selectionStart = start + 1;
				elem.selectionEnd = start + 1;
			}
		};
		elem.onkeyup = function(event) {
			saveInputField(event.target);
		};
		loadInputField(elem);
	}

	loadShapes();

	window.msg = function(text) {
  	codeOutput(LEVEL.MSG, text);
	}

	fengari.load('js = require("js") print = function(message) js.global:msg(message) end userDataToTable = function(userdata) if type(userdata) ~= "userdata" then return userdata end if #userdata == 1 then return userdata[0] end tab = {} for i = 0,(#userdata -1) do table.insert(tab, userdata[i]) end return table.unpack(tab) end')();

  for (let lib in oc) {
  	let functions = [];
  	for (let func in oc[lib]) {
  		let f = oc[lib][func].toString();
  		let re = /function\(([A-Za-z0-9_\-, ]*)\)/;
  		let matches = re.exec(f);
  		if (matches) {
				let args = matches[1].split(",");
				for (let i in args)
					args[i] = args[i].trim();
				functions.push(func + " = function(" + args.join(", ") + ") return userDataToTable(js.global.oc." + lib + ":" + func + "(" + args.join(", ") + ")) end");
			} else {
  			console.warn("No match for function in '" + f + "'");
  			console.debug(oc[lib][func]);
			}
		}
  	let lua = lib + ' = {' + functions.join(", ") + '}';
  	fengari.load(lua)();
	}

  let states = { alpha: "red", beta: "lightblue", release: "green" };
  let state = "beta";

  let state_elements = document.getElementsByClassName("state");
  for (let i = 0; i < state_elements.length; i++) {
  	let elem = state_elements[i];
  	elem.style.color = states[state];
  	elem.innerText = state.toUpperCase();
	}
</script>

</html>